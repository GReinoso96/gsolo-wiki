<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G Solo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="width: 100%;" class="return-link">
        <a href=".\index.html">Return Home</a>
    </div>
    <section>
        <table>
            <tr>
                <th colspan="2" id="qstTitle"></th>
            </tr>
            <tr>
                <th>Win Condition</th>
                <td id="qstWin"></td>
            </tr>
            <tr>
                <th>Fail Condition</th>
                <td id="qstFail"></td>
            </tr>
            <tr>
                <th>Fee</th>
                <td id="qstFee"></td>
            </tr>
            <tr>
                <th>Zenny Reward</th>
                <td id="qstZenny"></td>
            </tr>
            <tr>
                <td colspan="2" id="qstDesc"></td>
            </tr>
        </table>
        <table id="supplyTable">
            <tr>
                <th colspan="2">Supplies</th>
            </tr>
            <tr>

            </tr>
        </table>
        <table id="rewardTable">
            <tr>
                <th colspan="2">Rewards</th>
            </tr>
        </table>
        <table id="largeMonTable">
            <tr>
                <th colspan="2">Large Monsters</th>
            </tr>
            <tr>
                <td id="bossData" class="sm-text"></td>
            </tr>
        </table>
        <table id="smallMonTable">
            <tr>
                <th colspan="2">Small Monsters</th>
            </tr>
        </table>
    </section>
</body>
<script>
    var questID = findGetParameter("qid");

    if(!questID) {
        window.location.href = "./index.html";
    }

    var localeNames = ['None', 'Fortress', 'Forest and Hills', 'Desert', 'Swamp', 'Volcano', 'Jungle', 'Castle Schrade', 'Battlegrounds', 'Great Arena', 'Small Arena'];

    var rewardTypes = [ 'Base', 'Break Monster Part', "Break Rathian's Head", "Break Rathian's Wing", "Break Rathalos' Head", "Break Rathalos' Wing" ];

    var difficulty = [ 'Low Rank', 'High Rank', ' G Rank', 'Training' ];

    var stageName = [ 'None', 'Jungle 3', 'Jungle 1', 'Jungle 7', 'Jungle BC', 'Jungle 5', 'Swamp 3', 'Desert Secret', 'Battleground BC', 'Swamp 5', 'Fortress BC', 'Fortress 2', 'Fortress 5', 'NA', 'Fortress 1', 'NA', 'Swamp 1', 'NA', 'Jungle 4', 'Jungle 6', 'Schrade BC', 'FnH BC', 'Jungle 9', 'Jungle 10', 'NA', 'Schrade 1', 'Jungle 8', 'NA', 'Fortress 3', 'NA', 'Fortress 4', 'Fortress 6', 'FnH 6', 'FnH 3', 'FnH 10', 'FnH 8', 'FnH 9', 'FnH 4', 'FnH 2', 'FnH 1', 'FnH 5', 'FnH 7', 'FnH 11', 'FnH 12', 'Swamp 4', 'Desert 2', 'Jungle 2', 'Desert 6', 'Desert 9', 'Desert 8', 'Desert BC', 'Desert 1', 'Desert 4', 'Desert 10', 'Desert 5', 'Desert 11', 'Desert 7', 'Desert 3', 'Volcano 2', 'Volcano 4', 'Volcano 5', 'Volcano BC', 'Volcano 8', 'Volcano 1', 'Volcano 3', 'Volcano 6', 'Volcano 7', 'Swamp BC', 'Swamp 2', 'Swamp 9', 'Swamp 8', 'Swamp 10', 'Swamp 6', 'Swamp 11', 'Swamp Secret', 'Swamp 7', 'Minegarde Center', 'Guild Tavern', 'Market', 'Smithy', 'Guest House', 'Pawn Room', 'Rook Room', 'Bishop Room', 'Queen Room', 'King Room', 'Kokoto Room', 'Kokoto', 'Battleground 1', 'Arena BC', 'Great Arena', 'Small Arena' ];

    if(questID){
        fetch('./Quests/m'+questID+'.json',
                {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json'
                }
            }
        )
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json(); // Parse the JSON data
        })
        .then(data => {
            loadQuestData(data);
            //console.log(data); // Use the JSON data here
            //console.log(data.bossSize); // Access specific properties
        })
        .catch(error => {
            console.error('Error loading the JSON file:', error);
        });
    }

    function loadQuestData(quest) {
        document.getElementById("qstTitle").textContent = quest.questData.title + ' ' + quest.questData.stars + '-â˜…\r\n' + localeNames[quest.questData.locale] + ' - ' + difficulty[quest.difficulty];
        document.getElementById("qstWin").textContent = quest.questData.win;
        document.getElementById("qstFail").textContent = quest.questData.fail;
        document.getElementById("qstFee").textContent = quest.questData.fee + 'z';
        document.getElementById("qstZenny").textContent = quest.questData.reward + 'z (-' + quest.questData.cartCost + 'z/faint)';
        document.getElementById("qstDesc").textContent = quest.questData.description;

        // Supplies
        var supplyList = document.getElementById("supplyTable");
        quest.supplyData.supplies.forEach(element => {
            var suppTr = document.createElement('tr');
            var suppTd = document.createElement('td');
            suppTd.textContent = element.name + ' x' +element.amount;
            suppTd.classList.add('right-align');
            suppTd.classList.add('sm-text');
            suppTr.appendChild(suppTd);
            supplyList.appendChild(suppTr);
        });

        // Rewards
        var rewardList = document.getElementById("rewardTable");
        quest.rewardData.forEach(element => {
            var rewType = element.type;
            if (rewType == 32768) { rewType = 0 };
            var typeTr = document.createElement('tr');
            var typeTd = document.createElement('th');
            typeTd.textContent = rewardTypes[rewType];
            typeTr.appendChild(typeTd);
            rewardList.appendChild(typeTr);
            element.rewards.forEach(rew => {
                var rewTr = document.createElement('tr');
                var rewTd = document.createElement('td');
                rewTd.classList.add('sm-text');
                rewTd.textContent = rew.name + ' x' + rew.amount + ' (' + rew.chance + '%)';
                rewTd.classList.add('right-align');
                rewTr.appendChild(rewTd);
                rewardList.appendChild(rewTr);
            });
        });

        // Small Monsters
        var sMonList = document.getElementById('smallMonTable');
        var waveNum = 1;
        quest.smallMons.waves.forEach(element => {
            var waveTr = document.createElement('tr');
            var waveTd = document.createElement('th');
            waveTd.textContent = 'Wave ' + waveNum;
            waveNum++;
            waveTr.appendChild(waveTd);
            sMonList.appendChild(waveTr);
            element.monstages.forEach(stages => {
                var stTr = document.createElement('tr');
                var stTd = document.createElement('th');
                stTd.textContent = stageName[stages.stage];
                stTr.appendChild(stTd);
                sMonList.appendChild(stTr);
                stages.monsters.forEach(mons => {
                    var monTr = document.createElement('tr');
                    var monTd = document.createElement('td');
                    monTd.classList.add('sm-text');
                    monTd.textContent = mons.name + ' (' + mons.variant + ')' + ' x' + mons.quantity + '\r\nX: ' + mons.pos[0] + ' Y: ' + mons.pos[2] + ' Z: ' + mons.pos[1];
                    monTr.appendChild(monTd);
                    sMonList.appendChild(monTr);
                });
            });
        });

        // Large Monsters
        document.getElementById('bossData').textContent = 'Size Mult: ' + quest.bossSize + '% Size Class: ' + quest.bossSizeClass + '\r\nHealth Mult: ' + quest.monsterHP;
        var lMonList = document.getElementById('largeMonTable');
        quest.largeMons.forEach(element => {
            var waveTr = document.createElement('tr');
            var waveTd = document.createElement('th');
            waveTd.textContent = 'Wave ' + element.waveNum;
            waveTr.appendChild(waveTd);
            lMonList.appendChild(waveTr);
            element.monsters.forEach(mons => {
                var monTr = document.createElement('tr');
                var monTd = document.createElement('td');
                monTd.classList.add('sm-text');
                monTd.textContent = mons.name + ' (' + mons.variant + ')' + ' x' + mons.quantity + '\r\nX: ' + mons.pos[0] + ' Y: ' + mons.pos[2] + ' Z: ' + mons.pos[1] + '\r\nStrength: ' + mons.strength + '\r\nSpawn: ' + stageName[mons.stageId];
                monTr.appendChild(monTd);
                lMonList.appendChild(monTr);
            });
        });
    }

    function findGetParameter(parameterName) {
        var result = null,
            tmp = [];
        var items = location.search.substr(1).split("&");
        for (var index = 0; index < items.length; index++) {
            tmp = items[index].split("=");
            if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        }
        return result;
    }
</script>
</html>